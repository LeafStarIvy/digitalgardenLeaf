{# src/site/_includes/layouts/index.njk #}
<!doctype html>
<html lang="{{ meta.mainLanguage or 'en' }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ metadata.title or site.title or "My Digital Garden" }}</title>

    {# The template normally injects global CSS and the user CSS file automatically.
       If you need explicit links, add them here. #}
    {{ head | safe }}
  </head>

  <body class="garden-index">
    {# Top navbar (uses base template's classes, our SCSS will style it) #}
    <header class="navbar glass-navbar" role="banner">
      <div class="navbar-inner">
        <a href="/" aria-label="Home">
          <h1>{{ site.title or metadata.title or "Garden" }}</h1>
        </a>
        <div class="search-button" role="button" aria-label="Open search" tabindex="0">
          <i class="lucide lucide-search"></i>
          <span class="search-text">Search</span>
        </div>
      </div>
      <div>
        {# optional nav slots or icons go here #}
      </div>
    </header>

    <main class="content" role="main">
      {# Keep existing content handling for the home note #}
      <div class="page-card">
        <section class="note-hero">
          {{ content | hideDataview | taggify | link | safe }}
        </section>

        {# Optional index listing: try common collection names used by 11ty / the template #}
        {% set gardenNotes = collections.notes or collections.all or collections.posts %}
        {% if gardenNotes %}
          <section class="note-grid" aria-label="Notes">
            {% for n in gardenNotes %}
              {# skip if this item is the home note (dg-home) to avoid duplicate listing #}
              {% if n.data.dg_home %}
                {# skip #}
              {% else %}
                <article class="note-card" role="article" onclick="location.href='{{ n.url }}'">
                  <h3><a href="{{ n.url }}">{{ n.data.title or n.data.fileSlug or n.fileSlug }}</a></h3>
                  {% if n.data.excerpt %}
                    <p class="excerpt">{{ n.data.excerpt }}</p>
                  {% else %}
                    {%- set excerpt = (n.templateContent | striptags) | truncate(140) -%}
                    <p class="excerpt">{{ excerpt }}</p>
                  {% endif %}
                  <div class="meta">
                    <span>{{ n.date | date("yyyy-LL-dd") }}</span>
                    <span>{{ n.data.tags ? n.data.tags | length ~ ' tags' : '' }}</span>
                  </div>
                </article>
              {% endif %}
            {% endfor %}
          </section>
        {% endif %}
      </div>
    </main>

    {# Right sidebar + left filetree are rendered by base template includes; keep the slots intact #}
    {{ dynamics.common.afterContent | safe }}

    {{ scripts | safe }}
  </body>
</html>
