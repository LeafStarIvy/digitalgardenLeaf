/*
 * COSMIC DIGITAL GARDEN - DEEP SPACE THEME
 * Inspired by Super Mario Galaxy and deep space aesthetics
 * Color palette: Deep space blues, stellar grays, cosmic whites
 */

// =====================================================================
// 1. CORE VARIABLES - COSMIC BLUE & GRAY PALETTE
// =====================================================================
body {
  /* === DEEP SPACE COLOR SYSTEM === */
  
  /* Primary Deep Space Scale */
  --cosmic-void: #000511;           /* Absolute void */
  --cosmic-abyss: #001122;          /* Deep abyss */
  --space-deep: #002244;            /* Deepest space */
  --space-darker: #003366;          /* Darker space */
  --space-dark: #004488;            /* Dark space */
  --space-medium: #0066AA;          /* Medium space */
  --space-light: #0088CC;           /* Light space */
  --space-lighter: #33AADD;         /* Lighter space */
  --space-lightest: #66CCEE;        /* Lightest space */
  
  /* Stellar Gray Scale */
  --stellar-void: #0A0A0F;          /* Void gray */
  --stellar-deep: #151520;          /* Deep stellar */
  --stellar-dark: #222233;          /* Dark stellar */
  --stellar-medium: #333344;        /* Medium stellar */
  --stellar-light: #556677;         /* Light stellar */
  --stellar-lighter: #778899;       /* Lighter stellar */
  --stellar-bright: #99AABB;        /* Bright stellar */
  --stellar-lightest: #BBCCDD;      /* Lightest stellar */
  
  /* Cosmic Accent Colors */
  --cosmic-ice: #E6F3FF;            /* Ice blue */
  --cosmic-frost: #CCE7FF;          /* Frost blue */
  --cosmic-crystal: #B3DAFF;        /* Crystal blue */
  --cosmic-glow: #80CCFF;           /* Glow blue */
  --cosmic-energy: #4DB8FF;         /* Energy blue */
  --cosmic-plasma: #1AA3FF;         /* Plasma blue */
  
  /* Neutral Space Tones */
  --space-silver: #C5D1E0;          /* Silver tone */
  --space-mist: #A8B8CC;           /* Space mist */
  --space-dust: #8A9BB5;           /* Space dust */
  --space-nebula: #6D8099;         /* Nebula tone */
  
  /* Alert & Status Colors (space-themed) */
  --alert-danger: #FF6B6B;          /* Supernova red */
  --alert-warning: #FFD93D;         /* Solar flare yellow */
  --alert-success: #6BCF7F;         /* Nebula green */
  --alert-info: var(--cosmic-energy);/* Info blue */
  
  /* === BACKGROUND SYSTEM === */
  --bg-primary: var(--cosmic-void);
  --bg-secondary: var(--cosmic-abyss);
  --bg-tertiary: var(--space-deep);
  --bg-quaternary: var(--space-darker);
  --bg-overlay: rgba(0, 17, 34, 0.85);
  --bg-overlay-light: rgba(0, 34, 68, 0.75);
  --bg-glass: rgba(0, 68, 136, 0.15);
  --bg-glass-strong: rgba(0, 68, 136, 0.25);
  
  /* === TEXT SYSTEM === */
  --text-primary: var(--cosmic-ice);
  --text-secondary: var(--space-silver);
  --text-tertiary: var(--space-mist);
  --text-accent: var(--cosmic-glow);
  --text-muted: var(--space-dust);
  --text-dim: var(--stellar-light);
  --text-bright: #FFFFFF;
  --text-link: var(--cosmic-energy);
  --text-link-hover: var(--cosmic-glow);
  --text-heading: var(--cosmic-frost);
  
  /* === BORDER SYSTEM === */
  --border-primary: rgba(128, 204, 255, 0.2);
  --border-secondary: rgba(128, 204, 255, 0.15);
  --border-accent: rgba(128, 204, 255, 0.4);
  --border-subtle: rgba(85, 102, 119, 0.3);
  --border-strong: rgba(128, 204, 255, 0.6);
  
  /* === SHADOW SYSTEM === */
  --shadow-sm: 0 2px 8px rgba(0, 5, 17, 0.3);
  --shadow-md: 0 4px 16px rgba(0, 5, 17, 0.4);
  --shadow-lg: 0 8px 32px rgba(0, 5, 17, 0.5);
  --shadow-xl: 0 16px 48px rgba(0, 5, 17, 0.6);
  --shadow-glow: 0 0 24px rgba(128, 204, 255, 0.2);
  --shadow-glow-strong: 0 0 32px rgba(128, 204, 255, 0.3);
  
  /* === GRADIENTS === */
  --gradient-cosmic: linear-gradient(135deg, var(--cosmic-void) 0%, var(--space-deep) 50%, var(--space-darker) 100%);
  --gradient-stellar: linear-gradient(180deg, var(--stellar-void) 0%, var(--stellar-dark) 100%);
  --gradient-nebula: radial-gradient(ellipse at center, var(--space-darker) 0%, var(--cosmic-void) 70%);
  --gradient-aurora: linear-gradient(90deg, var(--cosmic-energy) 0%, var(--cosmic-glow) 50%, var(--cosmic-crystal) 100%);
  --gradient-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
  
  /* === TYPOGRAPHY === */
  --font-primary: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-heading: 'Space Grotesk', 'Segoe UI', sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
  
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-base: 1rem;
  --font-size-md: 1.125rem;
  --font-size-lg: 1.25rem;
  --font-size-xl: 1.5rem;
  --font-size-2xl: 2rem;
  --font-size-3xl: 2.5rem;
  --font-size-4xl: 3rem;
  
  --line-height-tight: 1.25;
  --line-height-base: 1.6;
  --line-height-loose: 1.8;
  
  --font-weight-light: 300;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  
  /* === SPACING & LAYOUT === */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  --space-3xl: 4rem;
  
  --content-width: 800px;        /* Wider content as requested */
  --content-width-wide: 1000px;
  --sidebar-width: 280px;
  --navbar-height: 64px;
  
  /* === BORDER RADIUS === */
  --radius-sm: 6px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --radius-full: 50px;
  
  /* === TRANSITIONS === */
  --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-base: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* === BACKDROP FILTERS === */
  --blur-sm: blur(4px);
  --blur-md: blur(8px);
  --blur-lg: blur(12px);
  --blur-xl: blur(16px);
}

// =====================================================================
// 2. GLOBAL RESET & BASE STYLES
// =====================================================================

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  font-family: var(--font-primary);
  font-size: var(--font-size-base);
  line-height: var(--line-height-base);
  color: var(--text-primary);
  background: var(--gradient-cosmic);
  background-attachment: fixed;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
  
  &::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--gradient-nebula);
    z-index: -2;
  }
  
  &::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(2px 2px at 20% 30%, var(--cosmic-glow), transparent),
      radial-gradient(2px 2px at 40% 70%, var(--cosmic-energy), transparent),
      radial-gradient(1px 1px at 90% 40%, var(--cosmic-crystal), transparent),
      radial-gradient(1px 1px at 60% 10%, var(--space-silver), transparent);
    background-size: 800px 800px;
    animation: starfield 120s linear infinite;
    opacity: 0.6;
    z-index: -1;
  }
}

@keyframes starfield {
  0% { transform: translate(0, 0); }
  100% { transform: translate(-800px, -800px); }
}

::selection {
  background: var(--bg-glass-strong);
  color: var(--text-bright);
}

// =====================================================================
// 3. TYPOGRAPHY
// =====================================================================

h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-heading);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  color: var(--text-heading);
  margin-bottom: var(--space-md);
  letter-spacing: -0.025em;
}

h1 {
  font-size: var(--font-size-3xl);
  background: var(--gradient-aurora);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 0 30px rgba(128, 204, 255, 0.5);
  margin-bottom: var(--space-lg);
}

h2 {
  font-size: var(--font-size-2xl);
  color: var(--cosmic-frost);
  margin-top: var(--space-2xl);
}

h3 {
  font-size: var(--font-size-xl);
  color: var(--cosmic-crystal);
  margin-top: var(--space-xl);
}

h4 {
  font-size: var(--font-size-lg);
  color: var(--space-silver);
}

p {
  margin-bottom: var(--space-md);
  line-height: var(--line-height-loose);
}

strong {
  color: var(--cosmic-glow);
  font-weight: var(--font-weight-semibold);
}

em {
  color: var(--space-silver);
  font-style: italic;
}

// =====================================================================
// 4. LINKS
// =====================================================================

a {
  color: var(--text-link);
  text-decoration: none;
  position: relative;
  transition: all var(--transition-base);
  
  &::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--cosmic-energy), var(--cosmic-glow));
    transition: width var(--transition-base);
  }
  
  &:hover {
    color: var(--text-link-hover);
    text-shadow: 0 0 8px rgba(128, 204, 255, 0.4);
    
    &::after {
      width: 100%;
    }
  }
  
  &.internal-link {
    color: var(--cosmic-glow);
    
    &:hover {
      color: var(--cosmic-crystal);
    }
  }
}

// =====================================================================
// 5. MAIN LAYOUT
// =====================================================================

.container {
  display: flex;
  min-height: 100vh;
  max-width: 100%;
}

// =====================================================================
// 6. NAVBAR
// =====================================================================

.navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--navbar-height);
  background: var(--bg-overlay);
  backdrop-filter: var(--blur-lg);
  border-bottom: 1px solid var(--border-secondary);
  z-index: 1000;
  
  .navbar-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
    padding: 0 var(--space-lg);
    max-width: 1400px;
    margin: 0 auto;
  }
  
  .navbar-brand {
    font-family: var(--font-heading);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--cosmic-glow);
    text-decoration: none;
    
    &:hover {
      color: var(--cosmic-crystal);
      text-shadow: 0 0 12px rgba(128, 204, 255, 0.4);
    }
  }
  
  .navbar-nav {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    
    a {
      color: var(--text-secondary);
      font-weight: var(--font-weight-medium);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      transition: all var(--transition-base);
      
      &:hover {
        background: var(--bg-glass);
        color: var(--text-primary);
        box-shadow: var(--shadow-glow);
      }
      
      &::after {
        display: none;
      }
    }
  }
}

// =====================================================================
// 7. SIDEBAR (FILE TREE)
// =====================================================================

.filetree-sidebar {
  position: fixed;
  top: var(--navbar-height);
  left: 0;
  width: var(--sidebar-width);
  height: calc(100vh - var(--navbar-height));
  background: var(--bg-overlay);
  backdrop-filter: var(--blur-md);
  border-right: 1px solid var(--border-secondary);
  overflow-y: auto;
  z-index: 100;
  padding: var(--space-lg);
  
  h1 {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-subtle);
  }
  
  .filetree {
    ul {
      list-style: none;
      padding-left: var(--space-md);
    }
    
    li {
      margin-bottom: var(--space-sm);
      
      &:first-child {
        padding-left: 0;
      }
    }
    
    a {
      display: block;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      color: var(--text-tertiary);
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
      
      &:hover {
        background: var(--bg-glass);
        color: var(--text-primary);
        transform: translateX(4px);
      }
      
      &.active,
      &[aria-current="page"] {
        background: var(--bg-glass-strong);
        color: var(--cosmic-glow);
        box-shadow: var(--shadow-glow);
      }
      
      &::after {
        display: none;
      }
    }
    
    .folder {
      font-weight: var(--font-weight-medium);
      color: var(--text-secondary);
      margin-bottom: var(--space-sm);
      
      &::before {
        content: 'üìÅ ';
        margin-right: var(--space-xs);
      }
    }
  }
}

// =====================================================================
// 8. CONTENT AREA
// =====================================================================

.content {
  margin-left: var(--sidebar-width);
  margin-top: var(--navbar-height);
  padding: var(--space-2xl) var(--space-xl);
  max-width: calc(var(--content-width) + var(--sidebar-width));
  width: 100%;
  min-height: calc(100vh - var(--navbar-height));
  
  // Center the content within its container
  .content-inner {
    max-width: var(--content-width);
    margin: 0 auto;
  }
}

// =====================================================================
// 9. RIGHT SIDEBAR (GRAPH, BACKLINKS, TOC)
// =====================================================================

.sidebar {
  position: fixed;
  top: var(--navbar-height);
  right: 0;
  width: var(--sidebar-width);
  height: calc(100vh - var(--navbar-height));
  background: var(--bg-overlay);
  backdrop-filter: var(--blur-md);
  border-left: 1px solid var(--border-secondary);
  padding: var(--space-lg);
  overflow-y: auto;
  z-index: 100;
  
  .sidebar-section {
    margin-bottom: var(--space-2xl);
    
    h3 {
      font-size: var(--font-size-md);
      color: var(--text-heading);
      margin-bottom: var(--space-md);
      padding-bottom: var(--space-sm);
      border-bottom: 1px solid var(--border-subtle);
    }
  }
  
  .toc {
    ul {
      list-style: none;
      padding-left: var(--space-md);
    }
    
    a {
      display: block;
      padding: var(--space-xs) var(--space-sm);
      font-size: var(--font-size-sm);
      color: var(--text-muted);
      border-radius: var(--radius-sm);
      
      &:hover {
        background: var(--bg-glass);
        color: var(--text-primary);
      }
      
      &::after {
        display: none;
      }
    }
  }
  
  .backlinks {
    .backlink-item {
      padding: var(--space-sm);
      margin-bottom: var(--space-sm);
      background: var(--bg-glass);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      
      a {
        font-weight: var(--font-weight-medium);
        color: var(--cosmic-energy);
        
        &:hover {
          color: var(--cosmic-glow);
        }
      }
      
      .context {
        font-size: var(--font-size-xs);
        color: var(--text-muted);
        margin-top: var(--space-xs);
      }
    }
  }
  
  .graph {
    #link-graph {
      width: 100%;
      height: 300px;
      border-radius: var(--radius-lg);
      background: var(--bg-glass);
      border: 1px solid var(--border-secondary);
    }
  }
}

// =====================================================================
// 10. SEARCH
// =====================================================================

.search-container {
  position: relative;
  
  .search-input {
    width: 100%;
    padding: var(--space-md);
    background: var(--bg-glass);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    color: var(--text-primary);
    font-size: var(--font-size-md);
    backdrop-filter: var(--blur-md);
    
    &::placeholder {
      color: var(--text-muted);
    }
    
    &:focus {
      outline: none;
      border-color: var(--border-accent);
      box-shadow: var(--shadow-glow);
    }
  }
  
  .search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-overlay);
    backdrop-filter: var(--blur-lg);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    margin-top: var(--space-xs);
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
    
    .search-result {
      padding: var(--space-md);
      border-bottom: 1px solid var(--border-subtle);
      
      &:hover {
        background: var(--bg-glass);
      }
      
      &:last-child {
        border-bottom: none;
      }
      
      .result-title {
        font-weight: var(--font-weight-medium);
        color: var(--cosmic-glow);
        margin-bottom: var(--space-xs);
      }
      
      .result-excerpt {
        font-size: var(--font-size-sm);
        color: var(--text-tertiary);
      }
    }
  }
}

// =====================================================================
// 11. CONTENT ELEMENTS
// =====================================================================

// Blockquotes
blockquote {
  padding: var(--space-lg);
  margin: var(--space-lg) 0;
  background: var(--bg-glass);
  border-left: 4px solid var(--cosmic-energy);
  border-radius: var(--radius-md);
  font-style: italic;
  color: var(--text-secondary);
  backdrop-filter: var(--blur-sm);
  
  p:last-child {
    margin-bottom: 0;
  }
}

// Lists
ul, ol {
  padding-left: var(--space-xl);
  margin-bottom: var(--space-lg);
  
  li {
    margin-bottom: var(--space-sm);
    line-height: var(--line-height-loose);
    
    &::marker {
      color: var(--cosmic-glow);
    }
  }
}

// Code
code {
  font-family: var(--font-mono);
  font-size: 0.9em;
  background: var(--stellar-dark);
  color: var(--cosmic-ice);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-subtle);
}

pre {
  background: var(--stellar-void);
  color: var(--cosmic-ice);
  padding: var(--space-lg);
  border-radius: var(--radius-lg);
  overflow-x: auto;
  margin: var(--space-lg) 0;
  border: 1px solid var(--border-secondary);
  box-shadow: var(--shadow-md);
  
  code {
    background: transparent;
    padding: 0;
    border: none;
  }
}

// Tables
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin: var(--space-lg) 0;
  background: var(--bg-glass);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  backdrop-filter: var(--blur-sm);
  
  th, td {
    padding: var(--space-md);
    text-align: left;
    border-bottom: 1px solid var(--border-subtle);
  }
  
  thead {
    th {
      background: var(--bg-glass-strong);
      font-weight: var(--font-weight-semibold);
      color: var(--text-heading);
      border-bottom: 2px solid var(--border-accent);
    }
  }
  
  tbody {
    tr {
      &:hover {
        background: var(--bg-glass);
      }
      
      &:last-child {
        td {
          border-bottom: none;
        }
      }
    }
  }
}

// Images
img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  margin: var(--space-lg) 0;
}

// Callouts
.callout {
  padding: var(--space-lg);
  margin: var(--space-lg) 0;
  background: var(--bg-glass);
  backdrop-filter: var(--blur-sm);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--cosmic-energy);
  position: relative;
  overflow: hidden;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-glass);
    pointer-events: none;
  }
  
  .callout-title {
    font-weight: var(--font-weight-semibold);
    color: var(--text-heading);
    margin-bottom: var(--space-sm);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }
  
  &.note {
    border-left-color: var(--cosmic-energy);
  }
  
  &.warning {
    border-left-color: var(--alert-warning);
  }
  
  &.important {
    border-left-color: var(--alert-danger);
  }
  
  &.tip {
    border-left-color: var(--alert-success);
  }
}

// =====================================================================
// 12. SCROLLBAR
// =====================================================================

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, var(--cosmic-energy), var(--cosmic-glow));
  border-radius: var(--radius-full);
  border: 2px solid var(--bg-secondary);
  
  &:hover {
    background: linear-gradient(180deg, var(--cosmic-glow), var(--cosmic-crystal));
  }
}

// Firefox scrollbar
* {
  scrollbar-width: thin;
  scrollbar-color: var(--cosmic-energy) var(--bg-secondary);
}

// =====================================================================
// 13. RESPONSIVE DESIGN
// =====================================================================

@media (max-width: 1200px) {
  .content {
    margin-right: var(--sidebar-width);
    max-width: calc(100vw - var(--sidebar-width) * 2);
  }
}

@media (max-width: 968px) {
  .filetree-sidebar,
  .sidebar {
    transform: translateX(-100%);
    transition: transform var(--transition-base);
    
    &.active {
      transform: translateX(0);
    }
  }
  
  .sidebar {
    transform: translateX(100%);
  }
  
  .content {
    margin-left: 0;
    margin-right: 0;
    max-width: 100%;
    padding: var(--space-xl) var(--space-lg);
    
    .content-inner {
      max-width: none;
    }
  }
  
  .navbar-nav {
    display: none;
  }
}

@media (max-width: 640px) {
  .content {
    padding: var(--space-lg) var(--space-md);
  }
  
  .navbar {
    .navbar-inner {
      padding: 0 var(--space-md);
    }
  }
  
  h1 {
    font-size: var(--font-size-2xl);
  }
  
  h2 {
    font-size: var(--font-size-xl);
  }
}
// =====================================================================
// 14. Floating shortcut buttons
// =====================================================================
.floating-buttons {
  position: fixed;
  bottom: 20px;
  left: 20px;
  display: flex;
  flex-direction: row; /* inline, side by side */
  gap: 12px; /* space between buttons */
  z-index: 9999;
}

.floating-buttons img {
  width: 32px;   /* smaller size */
  height: 32px;
  cursor: pointer;
  border-radius: 8px; /* soft rounded corners (optional) */
  transition: transform 0.25s ease, filter 0.25s ease;
}

.floating-buttons img:hover {
  transform: scale(1.2) rotate(-3deg); /* grow + slight tilt */
  filter: brightness(1.2); /* subtle glow effect */
}

// =====================================================================
// 15. Digital Garden ‚Äî Fullscreen & Theatre Mode
// =====================================================================

/* ======================
   Full replacement: Fullscreen + Theatre (project only)
   - Uses body.fullscreen-mode and body.theatre-mode
   - Keeps all normal theme styles untouched unless those classes are active
   - Fixes: sidebar hiding, youtube embed proportions, excalidraw safety,
     theatre overlays only active while theatre-mode ON
   ====================== */

/* --- Floating buttons (top-right) --- */
.fullscreen-btn,
#theatre-toggle-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 10010; /* above most site elements */
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, var(--text-accent, #667eea) 0%, #764ba2 100%);
  box-shadow: 0 8px 30px rgba(0,0,0,.45);
  transition: transform .18s cubic-bezier(.2,.8,.2,1), opacity .18s;
}
#theatre-toggle-btn { top: 72px; right: 20px; display: none; } /* only shown when fullscreen active */
.fullscreen-btn:hover,
#theatre-toggle-btn:hover { transform: translateY(-3px); }

/* --- Keep transitions smooth for main UI elements only when toggling --- */
.navbar,
.filetree-sidebar,
.sidebar,
.content,
.fullscreen-btn {
  transition: all 0.28s cubic-bezier(.2,.8,.2,1);
}

/* ============================================================
   FULLSCREEN / FOCUS MODE
   - Class toggled on <body>: .fullscreen-mode
   - PRESERVES fonts/colors; only reflows/layouts content and hides UI
   ============================================================ */
body.fullscreen-mode {
  /* 1) Hide non-content UI aggressively but safely */
  .navbar,
  .filetree-sidebar,
  .sidebar,
  .search-container,
  .site-header,
  .site-nav,
  .left-panel,
  .nav-bar,
  .nav-container,
  .graph-container,
  .local-graph,
  .global-graph,
  [id*="filetree"],
  [class*="filetree"],
  [id*="sidebar"],
  [class*="sidebar"] {
    opacity: 0 !important;
    pointer-events: none !important;
    display: none !important;
  }

  /* show theatre toggle button when fullscreen active */
  #theatre-toggle-btn { display: inline-flex !important; }

  /* 2) Widen and center the reading column; keep the vertical proportions */
  .content,
  main.content,
  main {
    max-width: 95vw !important;   /* fills ~95% width */
    margin: 0 auto !important;
    padding: 8vh 2vw !important;
    min-height: 100vh;
    display: block; /* keep normal flow so heights remain natural */
    box-sizing: border-box;
  }

  /* 3) Do not change font sizes globally (keeps your theme) ‚Äî only minor visual tweak */
  /* No font-size overrides here by design. */

  /* 4) Media: make responsive but preserve aspect ratio (YouTube fix) */
  .content img,
  .content picture,
  .content video,
  .content iframe,
  .content embed {
    max-width: 100% !important;
    width: 100% !important;
    height: auto !important;
    display: block;
    margin: 1rem auto;
  }

  /* Ensure iframe-based embeds (YouTube) keep 16:9 ratio using modern browsers' aspect-ratio */
  .content iframe[src*="youtube"],
  .content iframe[src*="youtube-nocookie"],
  .content iframe.youtube-embed,
  .content .video-embed iframe {
    width: 100% !important;
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
    max-height: calc(95vh - 160px) !important; /* avoid extremely tall videos pushing page offscreen */
  }

  /* For older embed wrappers that set fixed height on a parent, try to normalize:
     If you have wrapper .embed-responsive then ensure it uses aspect-ratio */
  .content .embed-responsive,
  .content .video-wrapper {
    width: 100% !important;
    aspect-ratio: 16 / 9 !important;
    height: auto !important;
  }

  /* 5) Excalidraw: don't break interactive min-height, just allow it to scale width */
  .content .excalidraw-embed,
  .content .excalidraw-container {
    width: 100% !important;
    min-height: 60vh; /* keep editing/viewing area usable */
  }

  /* 6) Widgets like flashcards/diagrams */
  .content .flashcards-container,
  .content .diagram-container,
  .content .chart-container {
    max-width: 100% !important;
    width: 100% !important;
  }

  /* 7) Large-screen cap */
  @media (min-width: 2000px) {
    .content { max-width: 1600px !important; }
    .content .flashcards-container,
    .content .cards-container { max-width: 1600px; margin: 0 auto; }
  }

  /* 8) Tablet + mobile adjustments */
  @media (max-width: 1200px) {
    .content { padding: 6vh 3vw !important; max-width: 90vw !important; }
  }
  @media (max-width: 768px) {
    .content { padding: 4vh 2vw !important; max-width: 92vw !important; }
    .fullscreen-btn { top: 12px; right: 12px; padding: 9px 12px; font-size: 13px; }
    #theatre-toggle-btn { top: 56px !important; right: 12px; }
  }
}

/* Support for Fullscreen API if content is requested fullscreen */
.content:fullscreen,
:fullscreen .content {
  max-width: 95vw !important;
  margin: 0 auto;
  padding: 8vh 2vw;
  img, iframe, embed, video { width: 100% !important; height: auto !important; }
  .excalidraw-embed, .excalidraw-container { width: 100% !important; min-height: 60vh; }
}

/* ============================================================
   THEATRE MODE (CINEMATIC)
   - Class toggled on <body>: .theatre-mode (should only be added while in fullscreen)
   - All theatre-only overlays and darkening are scoped to .theatre-mode
   ============================================================ */
body.theatre-mode {
  background: #000 !important; /* kill underlying visuals when theatre is active */
}

/* Hide site background and particle canvases while in theatre-mode (common selectors) */
body.theatre-mode .particles-js,
body.theatre-mode #particles-js,
body.theatre-mode .bg-canvas,
body.theatre-mode canvas.bg,
body.theatre-mode .galaxy-spiral-container {
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
}

/* Letterbox / top and bottom */
body.theatre-mode::before,
body.theatre-mode::after {
  content: "";
  position: fixed;
  left: 0; right: 0;
  height: 10vh;
  z-index: 10005;
  pointer-events: none;
  background: linear-gradient(to bottom, #000 0%, rgba(0,0,0,0) 80%);
}
body.theatre-mode::after { bottom: 0; background: linear-gradient(to top, #000 0%, rgba(0,0,0,0) 80%); }

/* Side cinema lights (left + right) ‚Äî only visible in theatre-mode */
.theatre-side-light {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 22vw;
  z-index: 10003;
  pointer-events: none;
  mix-blend-mode: screen;
  filter: blur(60px);
  opacity: 0;
  transition: opacity 520ms ease;
}
/* Start off-screen so they wrap around edges softly */
.theatre-side-light.left { left: -6vw;
  background: radial-gradient(40% 80% at 20% 50%, rgba(255,170,90,.18), rgba(0,0,0,0) 55%);
}
.theatre-side-light.right { right: -6vw;
  background: radial-gradient(40% 80% at 80% 50%, rgba(90,150,255,.14), rgba(0,0,0,0) 55%);
}
body.theatre-mode .theatre-side-light { opacity: 1; }

/* Vignette only while in theatre-mode */
.theatre-vignette {
  position: fixed; inset: 0; z-index: 10004; pointer-events: none;
  background: radial-gradient(ellipse at center, rgba(0,0,0,0) 65%, rgba(0,0,0,.95) 100%);
  opacity: 0; transition: opacity 520ms ease;
}
body.theatre-mode .theatre-vignette { opacity: 1; }

/* Grain only while theatre-mode */
.theatre-grain {
  position: fixed; inset: 0; z-index: 10006; pointer-events: none;
  opacity: 0; transition: opacity 520ms ease;
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,.28) 0 1px, transparent 1px 2px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.18) 0 1px, transparent 1px 2px);
  mix-blend-mode: overlay;
  animation: theatre-grain 1.3s steps(6) infinite;
}
@keyframes theatre-grain { 0% { transform: translate(0,0);} 100% { transform: translate(2px,-1px); } }
body.theatre-mode .theatre-grain { opacity: .03; }

/* Screen look for the note in theatre (centered, framed, scrollable) */
body.theatre-mode .content,
body.theatre-mode main,
body.theatre-mode article {
  max-width: 86vw !important;
  margin: 6vh auto !important;
  background: #0f0f10;
  color: #efefef;
  padding: 3.2rem 4rem !important;
  border-radius: 10px;
  box-shadow: 0 40px 140px rgba(0,0,0,.95), 0 0 140px rgba(0,0,0,.7) inset;
  transition: all 420ms ease;
  z-index: 10007;
}

/* Make sure media inside theatre mode keep aspect ratio and don't overflow viewport */
body.theatre-mode .content img,
body.theatre-mode .content picture,
body.theatre-mode .content video,
body.theatre-mode .content iframe,
body.theatre-mode .content embed {
  max-width: 100% !important;
  width: 100% !important;
  height: auto !important;
}

/* Again enforce 16:9 for iframes like youtube in theatre */
body.theatre-mode .content iframe[src*="youtube"],
body.theatre-mode .content iframe[src*="youtube-nocookie"] {
  aspect-ratio: 16 / 9 !important;
  height: auto !important;
  max-height: calc(86vh - 200px) !important;
}

/* Keep excalidraw usable */
body.theatre-mode .content .excalidraw-embed,
body.theatre-mode .content .excalidraw-container {
  min-height: 60vh !important;
  width: 100% !important;
}

/* Ensure overlays don't capture pointer events */
.theatre-side-light, .theatre-vignette, .theatre-grain { pointer-events: none !important; }

/* Print safety */
@media print {
  .fullscreen-btn, #theatre-toggle-btn,
  .theatre-side-light, .theatre-vignette, .theatre-grain { display: none !important; }
}
